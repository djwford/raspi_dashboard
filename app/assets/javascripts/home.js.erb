$(window).load(function() {    

  // resize the background window
  var theWindow        = $(window),
      $bg              = $("#bg"),
      aspectRatio      = $bg.width() / $bg.height();
                    
  function resizeBg() {
    if ( (theWindow.width() / theWindow.height()) < aspectRatio ) {
      $bg
        .removeClass()
        .addClass('bgheight');
    } else {
      $bg
        .removeClass()
        .addClass('bgwidth');
    }     
  }                     
  theWindow.resize(resizeBg).trigger("resize");

  // slideshow / carousel graphs  
});

// $(document).ready(function(){
//   $(function(){
//     $("#slides").slidesjs({
//       width: 940,
//       height: 528
//     });
//   });
// });
  


// Readings graphs
// _______________
  
// daily reading


$(function () {
  $('#temperature_today').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 300,
          width: 600,
          backgroundColor: 'rgba(175,172,172,0.48)',
          plotBackgroundColor: null,
        style:{
          fontSize: '12px',
        }
      },
      legend:{
        enabled: false
      },
      title: {
          text: 'Temperature Today',
          style: {
            color: "#E8FCB9"
          }
      },
      xAxis: {
          type: 'datetime',
          gridLineWidth: 0,
          labels:{
            style:{
              color: '#E8FCB9',
              fontSize: '15px',
            },
            dateTimeLabelFormats: {
              hour: '%H:%M'
            }
        },          
      },
      yAxis: {
        floor: 55,
        gridLineWidth: 0,
        labels:{
          style:{
            color: '#E8FCB9',
            fontSize: '15px',
          }
        },
        title:null        
      },
      plotOptions:{
        series:{
          marker:{
            enabled: false
          },
          // dataLabels:{
          //   enabled: true
          // }
        }
      },
      series: [{
        name: "Temperature",
        pointInterval: 120000,
        pointStart: <%= (Time.now.beginning_of_day.to_i) * 1000 %>,
        data: <%= JSON::parse(TempRecord.last.readings) %>,
        lineWidth: 3,
        color: "#E8FCB9"
      }]
  });
});

function update_daily_temp(temp){
  var chart = $('#temperature_today').highcharts();
  chart.series[0].addPoint(temp, true, true);
  $("#temp_display").html(temp);
}

// monthly reading

$(function () {
  $('#temperature_month').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      title: {
          text: 'Monthly Temperature',
          style: {
            color: "#E8FCB9"
          }
      },
      xAxis: {
          type: 'datetime',
          gridLineWidth: 0,
          labels:{
            style:{
              color: '#E8FCB9',
              fontSize: '15px',
            },      
          },                         
        },
      yAxis: {
        gridLineWidth: 0,
        labels:{
          style:{
            color: '#E8FCB9',
            fontSize: '15px',
          }
        },        
      },

      series: [
      {
        name: "Highs",
        pointInterval: (86400 * 1000),
        pointStart: <%= (Time.now.beginning_of_month.to_i) * 1000 %>,
        data: <%= TempRecord.monthly_extremes[0] %>
      },
      {
        name: "Lows",
        pointInterval: (86400 * 1000),
        pointStart: <%= (Time.now.beginning_of_month.to_i) * 1000 %>,
        data: <%= TempRecord.monthly_extremes[1] %>        

    }]
  });
});

// all_time readings
$(function () {
  $('#temperature_average').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      title: {
          text: 'Average Daily Temperature',
          style: {
            color: "#E8FCB9"
          }          
      },
      legend:{
        enabled: false
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: {
        title:null,
        gridLineWidth:0
      },

      series: [
      {
        name: "Average Temps.",
        pointInterval: (86400 * 1000),
        pointStart: <%= TempRecord.first.created_at.to_i * 1000 %>,
        data: <%= TempRecord.all_time %>
      }]
  });
});

// hourly_forecast
$(function () {
  $('#hourly_forecast_temperature').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      title: {
          text: 'Hourly Forecast',
          style: {
            color: "#E8FCB9"
          }          
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: {
        title:null
      },
      plotOptions:{
        series:{
          marker:{
            enabled: true
          },
          dataLabels:{
            enabled: true
          }
        }
      },
      series: [
      {
        name: "Temperature",
        pointInterval: (3600 * 1000),
        pointStart: <%= HourlyForecast.last.created_at.to_i * 1000 %>,
        data: <%= HourlyForecast.last.temperature %>
      },
 
      {
        name: "Wind Speed",
        pointInterval: (3600 * 1000),
        pointStart: <%= HourlyForecast.last.created_at.to_i * 1000 %>,
        data: <%= HourlyForecast.last.wind_speed %>
      }]
  });
});

// hourly_forecast_other
$(function () {
  $('#hourly_forecast_other').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      title: {
          text: 'Hourly Forecast Other Data',
          style: {
            color: "#E8FCB9"
          }          
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: {
        floor: 0,
        title:null
      },
      plotOptions:{
        series:{
          marker:{
            enabled: false
          },
          dataLabels:{
            enabled: false
          }
        }
      },
      series: [
      {
        name: "Precipitation Probability",
        pointInterval: (3600 * 1000),
        pointStart: <%= HourlyForecast.last.created_at.to_i * 1000 %>,
        data: <%= HourlyForecast.last.precip_probability %>
      },
      {
        name: "Humidity",
        pointInterval: (3600 * 1000),
        pointStart: <%= HourlyForecast.last.created_at.to_i * 1000 %>,
        data: <%= HourlyForecast.last.humidity %>
      },
      {
        name: "Cloud Cover",
        pointInterval: (3600 * 1000),
        pointStart: <%= HourlyForecast.last.created_at.to_i * 1000 %>,
        data: <%= HourlyForecast.last.cloud_cover %>
      }
      ]
  });
});

// gas bill graph
$(function () {
  $('#gas_usage').highcharts({
      chart: {
          type: 'column',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      xAxis: {
          // type: 'datetime',
          gridLineWidth: 0,
          dateTimeLabelFormats: {
            day: '%b'
          }          
      },  
      yAxis:{
        title:null
      }, 
      title: {
          text: 'Gas Usage',
          style: {
            color: "#E8FCB9"
          }          
      },
      series: [
      {
        name: "Avg. Daily Cost",
        pointInterval: (2419200000),
        <% bill_year = (UtilityBill.first.created_at).year %>
        pointStart: <%= (Time.local(bill_year,UtilityBill.first.month,1).to_i) * 1000 %>,        
        data: <%= UtilityBill.gas_usage %>
      }]
  });
});
// electric_usage
$(function () {
  $('#electric_usage').highcharts({
      chart: {
          type: 'column',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      xAxis: {
          type: 'datetime'
      },      
      title: {
          text: 'Gas Usage'
      },
      series: [
      {
        name: "Average Gas Cost per Day",
        pointInterval: (2419200000),
        <% bill_year = (UtilityBill.first.created_at).year %>
        pointStart: <%= (Time.local(bill_year,UtilityBill.first.month,1).to_i) * 1000 %>,        
        data: <%= UtilityBill.electric_usage %>
      }]
  });
});
// utility_prices
$(function () {
  $('#utility_prices').highcharts({
      chart: {
          type: 'line',
          animation: Highcharts.svg,
          height: 400,
          width: 700
      },
      xAxis: {
          type: 'datetime'
      },      
      title: {
          text: 'Utility Prices'
      },
      series: [
      {
        name: "Electricity Cost per KWh",
        pointInterval: (2419200000),
        <% bill_year = (UtilityBill.first.created_at).year %>
        pointStart: <%= (Time.local(bill_year,UtilityBill.first.month,1).to_i) * 1000 %>,        
        data: <%= UtilityBill.prices[0] %>
      },
      {
        name: "Gas Price per DecaTherm",
        pointInterval: (2419200000),
        <% bill_year = (UtilityBill.first.created_at).year %>
        pointStart: <%= (Time.local(bill_year,UtilityBill.first.month,1).to_i) * 1000 %>,        
        data: <%= UtilityBill.prices[1] %>
      }]
  });
});

